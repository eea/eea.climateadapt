<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
                      "http://www.docbook.org/xml/4.4/docbookx.dtd">
<book>
    <chapter id="setting_internal_structures">
        <title>Settings hierarchy</title>
        <section>
            <title>Introduction</title>
            <para>GeoNetwork stores many options and information inside the Settings table.
                Information is grouped into hierarchies where each node has a key/value pair and can
                have many children. Each key is limited to 32 characters while each value is limited
                to 250. The 2 top level hierarchies are system and harvesting. </para>
            <para>In the following sections, the indentation is used to show hierarchies. Names in
                bold represent keys with the value’s datatype in parenthesys. An
                <emphasis>italic</emphasis> font is used to indicate basic types (string, integer,
                boolean) while normal font with a | is used to represent a set of allowed values.
                Regarding the boolean type, value can be only true or false. A missing datatype
                means that the value of the node is not used. Square brackets indicate cardinality.
                If they are missing, a cardinality of [1..1] should be considered. </para>

        </section>
        <section>
            <title>The system hierarchy</title>
            <itemizedlist>
                <listitem>
                    <para>site : Contains information about the site </para>

                    <itemizedlist>
                        <listitem>
                            <para>name (<emphasis>string</emphasis>) : Name used to present this
                                site to other sites. Used to fill comboboxes or lists. </para>
                        </listitem>
                        <listitem>
                            <para>organization (<emphasis>string</emphasis>) : Name of the
                                organization/company/institute that is running GeoNetwork </para>
                        </listitem>
                        <listitem>
                            <para>siteId (<emphasis>string</emphasis>) : A UUID that uniquely
                                identifies the site. It is generated by the installer.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>platform : Contains information about the current version </para>

                    <itemizedlist>
                        <listitem>
                            <para>version (<emphasis>string</emphasis>) : GeoNetwork’s version in
                                the X.Y.Z format </para>
                        </listitem>
                        <listitem>
                            <para>subVersion (<emphasis>string</emphasis>) : A small description
                                about the version, like ’alpha-1’, ’beta’ etc...</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>server : Used when it is necessary to build absolute URLs to the
                        GeoNetwork server. This is the case, for example, when creating links inside
                        a metadata or when providing CS/W capabilities. </para>

                    <itemizedlist>
                        <listitem>
                            <para>host (<emphasis>string</emphasis>) : Main HTTP server’s address
                            </para>
                        </listitem>
                        <listitem>
                            <para>port (<emphasis>integer</emphasis>) : Main HTTP server’s port (can
                                be empty)</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>intranet : specify the network of the intranet </para>

                    <itemizedlist>
                        <listitem>
                            <para>network (<emphasis>string</emphasis>) : Network’s address </para>
                        </listitem>
                        <listitem>
                            <para>netmask (<emphasis>string</emphasis>) : Network’s netmask</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>z3950 : A container for Z39.50 server parameters </para>

                    <itemizedlist>
                        <listitem>
                            <para>enable (<emphasis>boolean</emphasis>) : If true, GeoNetwork will
                                start the Z30.50 server </para>
                        </listitem>
                        <listitem>
                            <para>port (<emphasis>integer</emphasis>) : The port opened by
                                GeoNetwork to listen to Z39.50 requests. Usually is 2100.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>proxy : This container speficy proxy configuration to use </para>

                    <itemizedlist>
                        <listitem>
                            <para>use (<emphasis>boolean</emphasis>) : If true, GeoNetwork will use
                                the given proxy for outgoing connections </para>
                        </listitem>
                        <listitem>
                            <para>host (<emphasis>string</emphasis>) : Proxy’s host </para>
                        </listitem>
                        <listitem>
                            <para>port (<emphasis>integer</emphasis>) : Proxy’s port </para>
                        </listitem>
                        <listitem>
                            <para>username (<emphasis>string</emphasis>) : Proxy’s credentials.
                            </para>
                        </listitem>
                        <listitem>
                            <para>password (<emphasis>string</emphasis>) : Proxy’s
                            credentials.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>feedback : Feedback is sent with proper web form or when downloading a
                        resource. </para>

                    <itemizedlist>
                        <listitem>
                            <para>email (<emphasis>string</emphasis>) : email address of a
                                GeoNetwork administrator or someone else </para>
                        </listitem>
                        <listitem>
                            <para>mailServer : This container represents the mail server that will
                                be used to send emails </para>

                            <itemizedlist>
                                <listitem>
                                    <para>host (<emphasis>string</emphasis>) : Address of the SMTP
                                        server to use </para>
                                </listitem>
                                <listitem>
                                    <para>port (<emphasis>string</emphasis>) : SMTP port to
                                    use</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>removedMetadata : This container contains settings about removed metadata. </para>

                    <itemizedlist>
                        <listitem>
                            <para>dir : This folder will contain removed metadata in MEF format. It
                                gets populated when the user deletes a metadata using the web
                                interface.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>ldap : Parameters for LDAP authentication </para>

                    <itemizedlist>
                        <listitem>
                            <para>use (<emphasis>boolean</emphasis>) </para>
                        </listitem>
                        <listitem>
                            <para>host (<emphasis>string</emphasis>) </para>
                        </listitem>
                        <listitem>
                            <para>port (<emphasis>integer</emphasis>) </para>
                        </listitem>
                        <listitem>
                            <para>defaultProfile (<emphasis>string</emphasis>) : Default
                                GeoNetwork’s profile to use when the profile user attribute does not
                                exist. </para>
                        </listitem>
                        <listitem>
                            <para>login </para>

                            <itemizedlist>
                                <listitem>
                                    <para>userDN (<emphasis>string</emphasis>) </para>
                                </listitem>
                                <listitem>
                                    <para>password (<emphasis>string</emphasis>)</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>distinguishedNames </para>

                            <itemizedlist>
                                <listitem>
                                    <para>base (<emphasis>string</emphasis>) </para>
                                </listitem>
                                <listitem>
                                    <para>users (<emphasis>string</emphasis>)</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>userAttribs : A container for user attributes present into the
                                LDAP directory that must be retrieved and used to create the user in
                                GeoNetwork. </para>

                            <itemizedlist>
                                <listitem>
                                    <para>name (<emphasis>string</emphasis>) </para>
                                </listitem>
                                <listitem>
                                    <para>password (<emphasis>string</emphasis>) </para>
                                </listitem>
                                <listitem>
                                    <para>profile (<emphasis>string</emphasis>)</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>
        </section>
        <section>
            <title>Harvesting nodes</title>
            <para>The second top level hierarchy is harvesting. All nodes added using the web
                interface are stored here. Each child has node in its key and its value can be
                geonetwork, webdav, csw or another depending on the node’s type. </para>
            <para>All harvesting nodes share a common setting structure, which is used by the
                harvesting engine to retrieve these common parameters. This imply that any new
                harvesting type must honor this structure, which is the following: </para>

            <itemizedlist>
                <listitem>
                    <para>site : A container for site information. </para>

                    <itemizedlist>
                        <listitem>
                            <para>name (<emphasis>string</emphasis>) : Node’s name as shown in the
                                harvesting list. </para>
                        </listitem>
                        <listitem>
                            <para>uuid (<emphasis>string</emphasis>) : A unique identifier assigned
                                by the system when the harvesting node is created. </para>
                        </listitem>
                        <listitem>
                            <para>useAccount (<emphasis>boolean</emphasis>) : Indicates if the
                                harvester has to authenticate to access the data. </para>

                            <itemizedlist>
                                <listitem>
                                    <para>username (<emphasis>string</emphasis>) : </para>
                                </listitem>
                                <listitem>
                                    <para>password (<emphasis>string</emphasis>) :</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>options : </para>

                    <itemizedlist>
                        <listitem>
                            <para>every (<emphasis>integer</emphasis>) : Timeout, in minutes,
                                between 2 consecutive harvesting. </para>
                        </listitem>
                        <listitem>
                            <para>oneRunOnly (<emphasis>boolean</emphasis>) : If true, the harvester
                                will harvest one time from this node and then it will set the status
                                to inactive. </para>
                        </listitem>
                        <listitem>
                            <para>status (active|inactive) : Indicates if the harvesting from this
                                node is stopped (inactive) or if the harvester is waiting until the
                                timeout comes.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>privileges [0..1] : This is a container for privileges to assign to each
                        imported metadata </para>

                    <itemizedlist>
                        <listitem>
                            <para>group (<emphasis>integer</emphasis>) [0..n] : Indicate a local
                                group. The node’s value is its local identifier. There can be
                                several group nodes each with its set of privileges. </para>

                            <itemizedlist>
                                <listitem>
                                    <para>operation (<emphasis>integer</emphasis>) [0..n] :
                                        Privilege to assign to the group. The node’s value is the
                                        numeric id of the operation like 0=view, 1=download, 2=edit
                                        etc...</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>categories [0..1] : This is a container for categories to assign to each
                        imported metadata </para>

                    <itemizedlist>
                        <listitem>
                            <para>category (<emphasis>integer</emphasis>) [0..n] : Indicate a local
                                category and the node’s value is its local identifier.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
                <listitem>
                    <para>info : Just a container for some information about harvesting from this
                        node. </para>

                    <itemizedlist>
                        <listitem>
                            <para>lastRun (<emphasis>string</emphasis>) : If not empty, tells when
                                the harvester harvested from this node. The value is the current
                                time in millis since 1 January, 1970.</para>
                        </listitem>
                    </itemizedlist>
                </listitem>
            </itemizedlist>
            <para>Privileges and categories nodes can or cannot be present depending on the
                harvesting type. In the following structures, this common structure is not shown.
                Only extra information specific to the harvesting type is described. </para>

            <section>
                <title>Nodes of type geonetwork</title>
                <para>This is the native harvesting supported by geonetwork 2.1 and above. </para>
                <itemizedlist>
                    <listitem>
                        <para>site : Contains host and account information </para>

                        <itemizedlist>
                            <listitem>
                                <para>host (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>port (<emphasis>integer</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>servlet (<emphasis>string</emphasis>)</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                    <listitem>
                        <para>search [0..n] : Contains the search parameters. If this element is
                            missing, an unconstrained search will be performed. </para>

                        <itemizedlist>
                            <listitem>
                                <para>freeText (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>title (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>abstract (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>keywords (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>digital (<emphasis>boolean</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>hardcopy (<emphasis>boolean</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>source (<emphasis>string</emphasis>)</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                    <listitem>
                        <para>groupsCopyPolicy [0..n] : Represents a copy policy for a remote group.
                            It is used to maintain remote privileges on harvested metadata. </para>

                        <itemizedlist>
                            <listitem>
                                <para>name (<emphasis>string</emphasis>) : Internal name (not
                                    localized) of a remote group. </para>
                            </listitem>
                            <listitem>
                                <para>policy (<emphasis>string</emphasis>) : Copy policy. For the
                                    group all, policies are: copy, copyToIntranet. For all other
                                    groups, policies are: copy, createAndCopy. The intranet group is
                                    not considered.</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
            </section>
            <section>
                <title>Nodes of type geonetwork20</title>
                <para>This type allows harvesting from old geonetwork 2.0.x nodes. </para>
                <itemizedlist>
                    <listitem>
                        <para>site : Contains host and account information </para>

                        <itemizedlist>
                            <listitem>
                                <para>host (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>port (<emphasis>integer</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>servlet (<emphasis>string</emphasis>)</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                    <listitem>
                        <para>search [0..n] : Contains the search parameters. If this element is
                            missing no harvesting will be performed but the host’s parameters will
                            be used to connect to the remote node. </para>

                        <itemizedlist>
                            <listitem>
                                <para>freeText (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>title (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>abstract (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>keywords (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>digital (<emphasis>boolean</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>hardcopy (<emphasis>boolean</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>siteId (<emphasis>string</emphasis>)</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
            </section>
            <section>
                <title>Nodes of type webdav</title>
                <para>This harvesting type is capable of connecting to a web server which is WEB DAV
                    enabled. </para>
                <itemizedlist>
                    <listitem>
                        <para>site : Contains the URL to connect to and account information </para>

                        <itemizedlist>
                            <listitem>
                                <para>url (<emphasis>string</emphasis>) : URL to connect to. Must be
                                    well formed, starting with ’http://’, ’file://’ or a supported
                                    protocol. </para>
                            </listitem>
                            <listitem>
                                <para>icon (<emphasis>string</emphasis>) : This is the icon that
                                    will be used as the metadata source’s logo. The image is taken
                                    from the images/harvesting folder and copied to the images/logos
                                    folder.</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                    <listitem>
                        <para>options </para>

                        <itemizedlist>
                            <listitem>
                                <para>recurse (<emphasis>boolean</emphasis>) : Indicates if the
                                    remote folder must be recursively scanned for metadata. </para>
                            </listitem>
                            <listitem>
                                <para>validate (<emphasis>boolean</emphasis>) : If set, the
                                    harvester will validate the metadata against its schema and the
                                    metadata will be harvested only if it is valid.</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
            </section>
            <section>
                <title>Nodes of type csw</title>
                <para>This type of harvesting is capable of querying a Catalogue Services for the
                    Web (CSW) server and retrieving all found metadata. </para>
                <itemizedlist>
                    <listitem>
                        <para>site </para>

                        <itemizedlist>
                            <listitem>
                                <para>capabUrl (<emphasis>string</emphasis>) : URL of the
                                    capabilities file that will be used to retrieve the operations
                                    address. </para>
                            </listitem>
                            <listitem>
                                <para>icon (<emphasis>string</emphasis>) : This is the icon that
                                    will be used as the metadata source’s logo. The image is taken
                                    from the images/harvesting folder and copied to the images/logos
                                    folder.</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                    <listitem>
                        <para>search [0..n] : Contains search parameters. If this element is
                            missing, an unconstrained search will be performed. </para>

                        <itemizedlist>
                            <listitem>
                                <para>freeText (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>title (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>abstract (<emphasis>string</emphasis>) </para>
                            </listitem>
                            <listitem>
                                <para>subject (<emphasis>string</emphasis>)</para>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
            </section>
        </section>
    </chapter>
</book>
