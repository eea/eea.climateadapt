<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE book PUBLIC "-//OASIS//DTD DocBook XML V4.4//EN"
                      "http://www.docbook.org/xml/4.4/docbookx.dtd">
<book>
    <chapter id="xml_services">
        <title>XML Services</title>
        <section>
            <title>Calling specifications</title>
            <section>
                <title>Calling XML services</title>
                <para>GeoNetwork provides access to several internal structures through the use of
                    XML services. These are much like HTML addresses but return XML instead. As an
                    example, consider the xml.info service: you can use this service to get some
                    system’s information without fancy styles and graphics. In GeoNetwork, XML
                    services have usually the xml. prefix in their address.</para>
                <section>
                    <title>Request</title>
                    <para>Each service accepts a set of parameters, which must be embedded into the
                        request. A service can be called using different HTTP methods, depending on
                        the structure of its request:</para>
                    <para>GET The parameters are sent using the URL address. On the server side,
                        these parameters are grouped into a flat XML document with one root and
                        several simple children. A service can be called this way only if the
                        parameters it accepts are not structured. <xref linkend="xml_request"/>
                        shows an example of such request and the parameters encoded in XML. POST
                        There are 3 variants of this method:</para>
                    <para>ENCODED The request has one of the following content types:
                            <literal>application/x-www-form-urlencoded</literal> or
                            <literal>multipart/form-data</literal>. The first case is very common
                        when sending web forms while the second one is used to send binary data
                        (usually files) to the server. In these cases, the parameters are not
                        structured so the rules of the GET method applies. Even if the second case
                        could be used to send XML documents, this possibility is not considered on
                        the server side. XML The content type is <literal>application/xml</literal>.
                        This is the common case when the client is not a browser but a specialized
                        client. The request is a pure XML document in string form, encoded using the
                        encoding specified into the prologue of the XML document. Using this form,
                        any type of request can be made (structured or not) so any service can be
                        called. SOAP The content type is <literal>application/soap+xml</literal>.
                        SOAP is a simple protocol used to access objects and services using XML.
                        Clients that use this protocol can embed XML requests into a SOAP structure.
                        On the server side, GeoNetwork will remove the SOAP structure and feed the
                        content to the service. Its response will be embedded again into a SOAP
                        structure and sent back to the caller. It makes sense to use this protocol
                        if it is the only protocol understood by the client.</para>
                    <figure id="xml_request">
                        <title>A GET request to a XML service and its request encoding</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<request> 
    <hitsPerPage>10</hitsPerPage> 
    <any /> 
</request>]]></programlisting>
                    </figure>
                </section>
                <section>
                    <title>Response</title>
                    <para>The response of an XML service always has a content type of
                            <literal>application/xml</literal> (the only exception are those
                        services which return binary data). The document encoding is the one
                        specified into the document’s prologue. Anyway, all GeoNetwork services
                        return documents in the UTF-8 encoding.</para>
                    <para>On a GET request, the client can force a SOAP response adding the
                            <literal>application/soap+xml</literal> content type to the Accept
                        header parameter.</para>
                </section>
            </section>
            <section>
                <title>Exception handling</title>
                <para>A response document having an error root element means that the XML service
                    raised an exception. This can happen under several conditions: bad parameters,
                    internal errors et cetera. In this cases the returned XML document has the following
                    structure:</para>
                <itemizedlist>
                    <listitem>
                        <para>error: This is the root element of the document. It has a mandatory
                            id attribute that represents an identifier of the error from a common
                            set. See <xref linkend="error_ids"/> for a list of all id values.</para>
                        <itemizedlist>
                            <listitem>
                                <para>message: A message related to the error. It can be a short
                                    description about the error type or it can contain some other
                                    information that completes the id code.</para>
                            </listitem>
                            <listitem>
                                <para>class: The Java class of the raised error (name without
                                    package information).</para>
                            </listitem>
                            <listitem>
                                <para>stack: The server’s stacktrace up to the point that generated
                                    the exception. It contains several at children, one for each
                                    nested level. Useful for debugging purposes.</para>
                                <itemizedlist>
                                    <listitem>
                                        <para>at: Information about a nested level of called code.
                                            It has the following mandatory attributes:</para>
                                        <para>class Java class of the called method. method Java
                                            called method. line Line, inside the called method’s
                                            source code where there the method call of the next
                                            nested level. file Source file where the class is
                                            defined.</para>
                                    </listitem>
                                </itemizedlist>
                            </listitem>
                            <listitem>
                                <para>object: An optional container for parameters or other values
                                    that caused the exception. In case a parameter is an XML object,
                                    this container will contain that object in XML form.</para>
                            </listitem>
                            <listitem>
                                <para>request: A container for some useful information that can be
                                    needed to debug the service.</para>
                                <itemizedlist>
                                    <listitem>
                                        <para>language: Language used when the service was called.
                                        </para>
                                    </listitem>
                                    <listitem>
                                        <para>service: Name of the called service.</para>
                                    </listitem>
                                </itemizedlist>
                            </listitem>
                        </itemizedlist>
                    </listitem>
                </itemizedlist>
                <table frame="all" id="error_ids" align="left">
                    <title>Summary of error ids</title>
                    <tgroup cols="3">
                        <colspec colnum="1" colname="c1" colwidth="1*"/>
                        <colspec colnum="2" colname="c2" colwidth="1.5*"/>
                        <colspec colnum="3" colname="c3" colwidth="2*"/>
                        <thead>
                            <row>
                                <entry>
                                    <para>id</para>
                                </entry>
                                <entry>
                                    <para>Meaning of message element</para>
                                </entry>
                                <entry>
                                    <para>Meaning of object element</para>
                                </entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>
                                    <para>error</para>
                                </entry>
                                <entry>
                                    <para>General message, human readable</para>
                                </entry>
                                <entry> </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>bad-format</para>
                                </entry>
                                <entry>
                                    <para>Reason</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>bad-parameter</para>
                                </entry>
                                <entry>
                                    <para>Name of the parameter</para>
                                </entry>
                                <entry>
                                    <para>Parameter’s bad value</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>file-not-found</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>File’s name</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>file-upload-too-big</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>missing-parameter</para>
                                </entry>
                                <entry>
                                    <para>Name of the parameter</para>
                                </entry>
                                <entry>
                                    <para>XML container where the parameter should have been
                                        present.</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>object-not-found</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>Object’s name</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>operation-aborted</para>
                                </entry>
                                <entry>
                                    <para>Reason of abort</para>
                                </entry>
                                <entry>
                                    <para>If present, the object that caused the abort</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>operation-not-allowed</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>resource-not-found</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>Resource’s name</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>service-not-allowed</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>Service’s name</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>service-not-found</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>Service’s name</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>user-login</para>
                                </entry>
                                <entry>
                                    <para>User login failed message</para>
                                </entry>
                                <entry>
                                    <para>User’s name</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>user-not-found</para>
                                </entry>
                                <entry>
                                    <para>-</para>
                                </entry>
                                <entry>
                                    <para>User’s id or name</para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>metadata-not-found</para>
                                </entry>
                                <entry>
                                    <para>The requested metadata was not found</para>
                                </entry>
                                <entry>
                                    <para>Metadata’s id</para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
                <para><xref linkend="mef_export_exception"/> shows an example of exception generated
                    by the mef.export service. The service complains about a missing parameter, as
                    you can see from the content of the id attribute. The object element contains
                    the xml request with an unknown test paremeter while the mandatory uuid
                    parameter (as specified by the message element) is missing.</para>
                <figure id="mef_export_exception">
                    <title>An example of generated exception</title>
                    <programlisting><?db-font-size 75% ?><![CDATA[<error>
    <message>uuid</message> 
    <class>MissingParameterEx</class> 
    <stack> 
        <at class="jeeves.utils.Util" file="Util.java" line="66" 
            method="getParam"/> 
        <at class="org.fao.geonet.services.mef.Export" file="Export.java" 
            line="60" method="exec"/> 
        <at class="jeeves.server.dispatchers.ServiceInfo" file="ServiceInfo.java" 
            line="226" method="execService"/> 
        <at class="jeeves.server.dispatchers.ServiceInfo" file="ServiceInfo.java" 
            line="129" method="execServices"/> 
        <at class="jeeves.server.dispatchers.ServiceManager" file="ServiceManager.java" 
            line="370" method="dispatch"/> 
    </stack> 
    <object> 
        <request> 
            <asd>ee</asd> 
        </request> 
    </object> 
    <request> 
        <language>en</language> 
        <service>mef.export</service> 
    </request> 
</error>]]></programlisting>
                </figure>
            </section>
        </section>
        <section>
            <title>General services</title>
            <section>
                <title>xml.info</title>
                <para>The xml.info service can be used to query the site about its configuration,
                    services, status and so on. For example, it is used by the harvesting web
                    interface to retrieve information about a remote node.</para>
                <section>
                    <title>Request</title>
                    <para>The xml request should contain at least one type element to indicates the
                        kind of information to retrieve. More type elements can be specified to
                        obtain more information at once. The set of allowed values are:</para>
                    <para>site Returns general information about the site like its name, id, etc...
                        categories Returns all site’s categories groups Returns all site’s groups
                        visible to the requesting user. If the user does not authenticate
                        theirselves, only the intranet and the all groups are visible. operations
                        Returns all possible operations on metadata regions Returns all geographical
                        regions usable for queries sources Returns all geonetwork sources that the
                        remote site knows. The result will contain:</para>
                    <itemizedlist>
                        <listitem>
                            <para>The remote node’s name and siteId</para>
                        </listitem>
                        <listitem>
                            <para>All source uuids and names that have been discovered through
                                harvesting.</para>
                        </listitem>
                        <listitem>
                            <para>All source uuids and names of metadata that have been imported
                                into the remote node through the MEF format.</para>
                        </listitem>
                    </itemizedlist>
                    <itemizedlist>
                        <listitem>
                            <para>Administrators can see all users into the system (normal, other
                                administrators, etc...)</para>
                        </listitem>
                        <listitem>
                            <para>User administrators can see all users they can administrate and
                                all other user administrators in the same group set. The group set
                                is defined by all groups visible to the user administration, beside
                                the All and the intranet groups.</para>
                        </listitem>
                        <listitem>
                            <para>A logged user can se only theirself.</para>
                        </listitem>
                        <listitem>
                            <para>A guest cannot see any user.</para>
                        </listitem>
                    </itemizedlist>
                    <figure id="xml_request_example">
                        <title>Request example</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<request>
    <type>site</type>
    <type>groups</type>
</request>]]></programlisting>
                    </figure>
                </section>
                <section>
                    <title>Response</title>
                    <para>Each type element produces an XML subtree so the response to the previous
                        request is like this:</para>
                    <figure id="xml_response_example">
                        <title>Response example</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<info> 
    <site>...</site> 
    <categories>...</categories> 
    <groups>...</groups> 
    ... 
</info>]]></programlisting>
                    </figure>
                    <para>Here follows the structure of each subtree:</para>
                    <itemizedlist>
                        <listitem>
                            <para>site: This is the container</para>
                            <itemizedlist>
                                <listitem>
                                    <para>name: Human readable site name</para>
                                </listitem>
                                <listitem>
                                    <para>siteId: Universal unique identifier of the site</para>
                                </listitem>
                                <listitem>
                                    <para>platform: This is just a container to hold the site’s
                                        backend</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name: Plaform name. For GeoNetwork installations
                                                it must be geonetwork.</para>
                                        </listitem>
                                        <listitem>
                                            <para>version: Platform version, given in the X.Y.Z
                                                format</para>
                                        </listitem>
                                        <listitem>
                                            <para>subVersion: Additional version notes, like
                                                ’alpha-1’ or ’beta-2’.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                            <para>Example:</para>
                            <figure id="xml_response_site_info">
                                <title>Example site information</title>
                                <programlisting><?db-font-size 75% ?><![CDATA[<site> 
    <name>My site</name> 
    <organization>FAO</organization> 
    <siteId>0619cc50-708b-11da-8202-000d9335906e</siteId> 
    <platform> 
        <name>geonetwork</name> 
        <version>2.2.0</version> 
    </platform> 
</site>]]></programlisting>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>categories: This is the container for categories.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>category [0..n]: A single GeoNetwork’s category. This
                                        element has an id attribute which represents the local
                                        identifier for the category. It can be usefull to a client
                                        to link back to this category.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name: Category’s name</para>
                                        </listitem>
                                        <listitem>
                                            <para>label: The localized labels used to show the
                                                category on screen. See <xref
                                                  linkend="xml_response_categories"/>.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                            <figure id="xml_response_categories">
                                <title>Example response for categories</title>
                                <programlisting><?db-font-size 75% ?><![CDATA[<categories> 
    <category id="1"> 
        <name>datasets</name> 
        <label> 
            <en>Datasets</en> 
            <fr>Jeux de données</fr> 
        </label> 
    </category> 
</categories>]]></programlisting>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>groups: This is the container for groups</para>
                            <itemizedlist>
                                <listitem>
                                    <para>group [2..n]: This is a Geonetwork group. There are at
                                        least the internet and intranet groups. This element has an
                                        id attribute which represents the local identifier for the
                                        group.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name: Group’s name</para>
                                        </listitem>
                                        <listitem>
                                            <para>description: Group’s description</para>
                                        </listitem>
                                        <listitem>
                                            <para>referrer: The user responsible for this group
                                            </para>
                                        </listitem>
                                        <listitem>
                                            <para>email: The email address to notify when a map is
                                                downloaded</para>
                                        </listitem>
                                        <listitem>
                                            <para>label: The localized labels used to show the
                                                group on screen. See <xref
                                                  linkend="xml_response_groups"/>.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                            <figure id="xml_response_groups">
                                <title>Example response for groups</title>
                                <programlisting><?db-font-size 75% ?><![CDATA[<groups> 
    <group id="1"> 
        <name>editors</name> 
        <label> 
            <en>Editors</en> 
            <fr>Éditeurs</fr> 
        </label> 
    </group> 
</groups>]]></programlisting>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>operations: This is the container for the operations</para>
                            <itemizedlist>
                                <listitem>
                                    <para>operation [0..n]: This is a possible operation on
                                        metadata. This element has an id attribute which represents
                                        the local identifier for the operation.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name: Short name for the operation.</para>
                                        </listitem>
                                        <listitem>
                                            <para>reserved: Can be y or n and is used to
                                                distinguish between system reserved and user defined
                                                operations.</para>
                                        </listitem>
                                        <listitem>
                                            <para>label: The localized labels used to show the
                                                operation on screen. See <xref
                                                  linkend="xml_response_operations"/>.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                            <figure id="xml_response_operations">
                                <title>Example response for operations</title>
                                <programlisting><?db-font-size 75% ?><![CDATA[<operations> 
    <operation id="0"> 
        <name>view</name> 
        <label> 
            <en>View</en> 
            <fr>Voir</fr> 
        </label> 
    </operation> 
</operations>]]></programlisting>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>regions: This is the container for geographical regions</para>
                            <itemizedlist>
                                <listitem>
                                    <para>region [0..n]: This is a region present into the system.
                                        This element has an id attribute which represents the local
                                        identifier for the operation.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>north: North coordinate of the bounding box.
                                            </para>
                                        </listitem>
                                        <listitem>
                                            <para>south: South coordinate of the bounding box.
                                            </para>
                                        </listitem>
                                        <listitem>
                                            <para>west: West coordinate of the bounding box.
                                            </para>
                                        </listitem>
                                        <listitem>
                                            <para>east: east coordinate of the bounding box.
                                            </para>
                                        </listitem>
                                        <listitem>
                                            <para>label: The localized labels used to show the
                                                region on screen. See <xref
                                                  linkend="xml_response_regions"/>.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                            <figure id="xml_response_regions">
                                <title>Example response for regions</title>
                                <programlisting><?db-font-size 75% ?><![CDATA[<regions> 
    <region id="303"> 
        <north>82.99</north> 
        <south>26.92</south> 
        <west>-37.32</west> 
        <east>39.24</east> 
        <label> 
            <en>Western Europe</en> 
            <fr>Western Europe</fr> 
        </label> 
    </region> 
</regions>]]></programlisting>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>sources: This is the container.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>source [0..n]: A source known to the remote node.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name: Source’s name</para>
                                        </listitem>
                                        <listitem>
                                            <para>uuid: Source’s unique identifier</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                            <figure id="xml_response_source">
                                <title>Example response for a source</title>
                                <programlisting><?db-font-size 75% ?><![CDATA[<sources> 
    <source> 
        <name>My Host</name> 
        <uuid>0619cc50-708b-11da-8202-000d9335906e</uuid> 
    </source> 
</sources>]]></programlisting>
                            </figure>
                        </listitem>
                        <listitem>
                            <para>users: This is the container for user information</para>
                            <itemizedlist>
                                <listitem>
                                    <para>user [0..n]: A user of the system</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>id: The local identifier of the user</para>
                                        </listitem>
                                        <listitem>
                                            <para>username: The login name</para>
                                        </listitem>
                                        <listitem>
                                            <para>surname: The user’s surname. Used for display
                                                purposes.</para>
                                        </listitem>
                                        <listitem>
                                            <para>name: The user’s name. Used for display purposes.
                                            </para>
                                        </listitem>
                                        <listitem>
                                            <para>profile: User’s profile, like Administrator,
                                                Editor, UserAdmin etc...</para>
                                        </listitem>
                                        <listitem>
                                            <para>address:</para>
                                        </listitem>
                                        <listitem>
                                            <para>state:</para>
                                        </listitem>
                                        <listitem>
                                            <para>zip:</para>
                                        </listitem>
                                        <listitem>
                                            <para>country:</para>
                                        </listitem>
                                        <listitem>
                                            <para>email:</para>
                                        </listitem>
                                        <listitem>
                                            <para>organisation:</para>
                                        </listitem>
                                        <listitem>
                                            <para>kind:</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                            <figure id="xml_response_user">
                                <title>Example response for a user</title>
                                <programlisting><?db-font-size 75% ?><![CDATA[<users> 
    <user> 
        <id>3</id> 
        <username>eddi</username> 
        <surname>Smith</surname> 
        <name>John</name> 
        <profile>Editor</profile> 
        <address/> 
        <state/> 
        <zip/> 
        <country/> 
        <email/> 
        <organisation/> 
        <kind>gov</kind> 
    </user> 
</users>]]></programlisting>
                            </figure>
                        </listitem>
                    </itemizedlist>
                </section>
                <section>
                    <title>Localized entities</title>
                    <para>Localized entities have a general label element which contains the
                        localized strings in all supported languages. This element has as many
                        children as the supported languages. Each child has a name that reflect the
                        language code while its content is the localized text. Here is an example of
                        such elements:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<label> 
    <en>Editors</en> 
    <fr>Éditeurs</fr> 
    <es>Editores</es> 
</label>]]></programlisting>
                </section>
            </section>
            <section>
                <title>xml.forward</title>
                <para>This is just a router service. It is used by Javascript code to connect to a
                    remote host because a Javascript program cannot access a machine other than its
                    server. For example, it is used by the harvesting web interface to query a
                    remote host and retrieve the list of site ids.</para>
                <section>
                    <title>Request</title>
                    <figure id="xml_service_request">
                        <title>The service’s request</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<request> 
    <site> 
        <url>...</url> 
        <type>...</type> 
        <account> 
            <username>...</username> 
            <password>...</password> 
        </account> 
    </site> 
    <params>...</params> 
</request>]]></programlisting>
                    </figure>
                    <para>where:</para>
                    <para>site A container for site information where the request will be forwarded.</para>
                    <para>url Indicates the remote url to connect to. Usually points to a
                        GeoNetwork’s xml service but can point to any XML service. type Its only
                        purpose is to discriminate geonetwork nodes which use a different
                        authentication scheme. The value geonetwork indicates these nodes. Any other
                        value, or if the element is missing, indicate a generic node. account This
                        element is optional. If present, the provided credentials will be used to
                        authenticate to the remote site. params This is just a container for the
                        request that must be executed remotely.</para>
                    <figure id="xml_server_info_request">
                        <title>Request for info from a remote server</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<request> 
    <site> 
        <url>http://mynode.org:8080/geonetwork/srv/en/xml.info</url> 
    </site> 
    <params> 
        <request> 
            <type>site<type> 
        </request> 
    </params> 
</request>]]></programlisting>
                    </figure>
                    <para>Please note that this service uses the GeoNetwork’s proxy
                    configuration.</para>
                </section>
                <section>
                    <title>Response</title>
                    <para>The response is just the response from the remote service.</para>
                </section>
            </section>
        </section>
        <section>
            <title>Harvesting services</title>
            <section>
                <title>Introduction</title>
                <para>This chapter provides a detailed explanation of the GeoNetwork’s harvesting
                    services. These services allow a complete control over the harvesting behaviour.
                    They are used by the web interface and can be used by any other client.</para>
            </section>
            <section>
                <title>xml.harvesting.get</title>
                <para>Retrieves information about one or all configured harvesting nodes.</para>
                <section>
                    <title>Request</title>
                    <para>Called with no parameters returns all nodes. Example:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<request/>]]></programlisting>
                    <para>Otherwise, an id parameter can be specified:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<request> 
    <id>123</id> 
</request>]]></programlisting>
                </section>
                <section>
                    <title>Response</title>
                    <para>When called with no parameters the service provide its output inside a
                        nodes container. You get as many node elements as are configured. <xref
                            linkend="xml_harvesting_get"/> shows an example of output.</para>
                    <figure id="xml_harvesting_get">
                        <title>Example of an xml.harvesting.get response for a geonetwork node</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<nodes> 
    <node id="125" type="geonetwork"> 
        <site> 
            <name>test 1</name> 
            <uuid>0619cc50-708b-11da-8202-000d9335aaae</uuid> 
            <host>localhost</host> 
            <port>8080</port> 
            <servlet>geonetwork</servlet> 
            <account> 
                <use>false</use> 
                <username /> 
                <password /> 
            </account> 
        </site> 
        <searches> 
            <search> 
                <freeText /> 
                <title /> 
                <abstract /> 
                <keywords /> 
                <digital>false</digital> 
                <hardcopy>false</hardcopy> 
                <source> 
                    <uuid>0619cc50-708b-11da-8202-000d9335906e</uuid> 
                    <name>Food and Agriculture Organization</name> 
                </source> 
            </search> 
        </searches> 
        <options> 
            <every>90</every> 
            <oneRunOnly>false</oneRunOnly> 
            <status>inactive</status> 
        </options> 
        <info> 
            <lastRun /> 
            <running>false</running> 
        </info> 
        <groupsCopyPolicy> 
            <group name="all" policy="copy"/> 
            <group name="mygroup" policy="createAndCopy"/> 
        </groupsCopyPolicy> 
        <categories> 
            <category id="4"/> 
        </categories> 
    </node> 
</nodes>]]></programlisting>
                    </figure>
                    <para>If you specify an id, you get a response like that one in <xref
                            linkend="xml_response_webdav"/> (for a web DAV node).</para>
                    <figure id="xml_response_webdav">
                        <title>Example of an xml.harvesting.get response for a WebDAV node</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<node id="165" type="webdav"> 
    <site> 
        <name>test 1</name> 
        <uuid>0619cc50-708b-11da-8202-000d9335aaae</uuid> 
        <url>http://www.mynode.org/metadata</url> 
        <icon>default.gif</icon> 
        <account> 
            <use>true</use> 
            <username>admin</username> 
            <password>admin</password> 
        </account> 
    </site> 
    <options> 
        <every>90</every> 
        <oneRunOnly>false</oneRunOnly> 
        <recurse>false</recurse> 
        <validate>true</validate> 
        <status>inactive</status> 
    </options> 
    <privileges> 
        <group id="0"> 
            <operation name="view" /> 
        </group> 
        <group id="14"> 
            <operation name="download" /> 
        </group> 
    </privileges> 
    <categories> 
        <category id="2"/> 
    </categories> 
    <info> 
        <lastRun /> 
        <running>false</running> 
    </info> 
</node>]]></programlisting>
                    </figure>
                    <para>The node’s structure has a common XML format, plus some additional
                        information provided by the harvesting types. In the following structure,
                        each element has a cardinality specified using the [x..y] notation, where x
                        and y denote the minimum and the maximum values. The cardinality [1..1] is
                        omitted for clarity.</para>
                    <itemizedlist>
                        <listitem>
                            <para>node: The root element. It has a mandatory id attribute that
                                represents the internal identifier and a mandatory type attribute
                                which indicates the harvesting type.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>site: A container for site information.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name (<emphasis>string</emphasis>): The node’s
                                                name used to describe the harvesting.</para>
                                        </listitem>
                                        <listitem>
                                            <para>uuid (<emphasis>string</emphasis>): This is a
                                                system generated unique identifier associated to the
                                                harvesting node. This is used as the source field
                                                into the Metadata table to group all metadata from
                                                the remote node.</para>
                                        </listitem>
                                        <listitem>
                                            <para>account: A container for account information.</para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>use (<emphasis>boolean</emphasis>): true
                                                  means that the harvester will use the
                                                  provided username and password to
                                                  authenticate itself. The authentication
                                                  mechanism depends on the harvesting type.
                                                  </para>
                                                </listitem>
                                                <listitem>
                                                  <para>username (<emphasis>string</emphasis>):
                                                  Username on the remote node.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>password (<emphasis>string</emphasis>):
                                                  Password on the remote node.</para>
                                                </listitem>
                                            </itemizedlist>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>options: A container for generic options.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>every (<emphasis>integer</emphasis>): Harvesting
                                                interval in minutes.</para>
                                        </listitem>
                                        <listitem>
                                            <para>oneRunOnly (<emphasis>boolean</emphasis>): After
                                                the first run, the entry’s status will be set to
                                                inactive.</para>
                                        </listitem>
                                        <listitem>
                                            <para>status (<emphasis>string</emphasis>): Indicates
                                                if the harvesting from this node is stopped
                                                (inactive) or if the harvester is waiting for the
                                                timeout (active).</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>privileges [0..1]: A container for privileges that must be
                                        associated to the harvested metadata. This optional element
                                        is present only if the harvesting type supports it.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>group [0..n]: A container for allowed operations
                                                associated to this group. It has the id attribute
                                                which value is the identifier of a GeoNetwork group.</para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>operation [0..n]: Specifies an operation
                                                  to associate to the containing group. It has
                                                  a name attribute which value is one of the
                                                  supported operation names. The only
                                                  supported operations are:
                                                  <emphasis>view</emphasis>,
                                                  <emphasis>dynamic</emphasis>,
                                                  <emphasis>featured</emphasis>.</para>
                                                </listitem>
                                            </itemizedlist>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>categories [0..1]: This is a container for categories to
                                        assign to each imported metadata. This optional element is
                                        present if the harvesting type supports it.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>category (<emphasis>integer</emphasis>) [0..n]:
                                                Represents a local category and the id attribute is
                                                its local identifier.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>info: A container for general information.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>lastRun (<emphasis>string</emphasis>): The
                                                lastRun element will be filled as soon as the
                                                harvester starts harvesting from this entry. The
                                                value is the</para>
                                        </listitem>
                                        <listitem>
                                            <para>running (<emphasis>boolean</emphasis>): True if
                                                the harvester is currently running.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>error: This element will be present if the harvester
                                        encounters an error during harvesting.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>code (<emphasis>string</emphasis>): The error
                                                code, in string form.</para>
                                        </listitem>
                                        <listitem>
                                            <para>message (<emphasis>string</emphasis>): The
                                                description of the error.</para>
                                        </listitem>
                                        <listitem>
                                            <para>object (<emphasis>string</emphasis>): The object
                                                that caused the error (if any). This element can be
                                                present or not depending on the case.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                </section>
                <section>
                    <title>Errors</title>
                    <itemizedlist>
                        <listitem>
                            <para>ObjectNotFoundEx If the id parameter is provided but the node
                                cannot be found.</para>
                        </listitem>
                    </itemizedlist>
                </section>
            </section>
            <section>
                <title>xml.harvesting.add</title>
                <para>Create a new harvesting node. The node can be of any type supported by
                    GeoNetwork (GeoNetwork node, web folder etc...). When a new node is created, its
                    status is set to inactive. A call to the xml.harvesting.start service is
                    required to start harvesting.</para>
                <section>
                    <title>Request</title>
                    <para>The service requires an XML tree with all information the client wants to
                        add. In the following sections, default values are given in parenthesis
                        (after the parameter’s type) and are used when the parameter is omitted. If
                        no default is provided, the parameter is mandatory. If the type is boolean,
                        only the true and false strings are allowed.</para>
                    <para>All harvesting nodes share a common XML structure that must be honored.
                        Please, refer to the previous section for elements explanation. Each node
                        type can add extra information to that structure. The common structure is
                        here described:</para>
                    <itemizedlist>
                        <listitem>
                            <para>node: The root container. The type attribute is mandatory and
                                must be one of the supported harvesting types.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>site [0..1]</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name (<emphasis>string</emphasis>, ”)</para>
                                        </listitem>
                                        <listitem>
                                            <para>account [0..1]</para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>use (<emphasis>boolean</emphasis>,
                                                  ’false’)</para>
                                                </listitem>
                                                <listitem>
                                                  <para>username (<emphasis>string</emphasis>, ”)
                                                  </para>
                                                </listitem>
                                                <listitem>
                                                  <para>password (<emphasis>string</emphasis>,
                                                  ”)</para>
                                                </listitem>
                                            </itemizedlist>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>options [0..1]</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>every (<emphasis>integer</emphasis>, ’90’)</para>
                                        </listitem>
                                        <listitem>
                                            <para>oneRunOnly (<emphasis>boolean</emphasis>,
                                            ’false’)</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>privileges [0..1]: Can be omitted but doing so the
                                        harvested metadata will not be visible. Please note that
                                        privileges are taken into account only if the harvesting
                                        type supports them.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>group [0..n]: It must have the id attribute which
                                                value should be the identifier of a GeoNetwork
                                                group. If the id is not a valid group id, all
                                                contained operations will be discarded.</para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>operation [0..n]: It must have a name
                                                  attribute which value must be one of the
                                                  supported operation names.</para>
                                                </listitem>
                                            </itemizedlist>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>categories [0..1]: Please, note that categories will be
                                        assigned to metadata only if the harvesting type supports
                                        them.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>category (<emphasis>integer</emphasis>) [0..n]:
                                                The mandatory id attribute is the category’s local
                                                identifier.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    <para>Please note that even if clients can store empty values (”) for many
                        parameters, before starting the harvesting entry those parameters should be
                        properly set in order to avoid errors.</para>
                    <para>In the following sections, the XML structures described inherit from this
                        one here so the common elements have been removed for clarity reasons
                        (unless they are containers and contain new children).</para>
                    <para>Standard GeoNetwork harvesting</para>
                    <para>To create a node capable of harvesting from another GeoNetwork node, the
                        following XML information should be provided:</para>
                    <itemizedlist>
                        <listitem>
                            <para>node: The type attribute is mandatory and must be geonetwork.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>site</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>host (<emphasis>string</emphasis>, ”): The
                                                GeoNetwork node’s host name or IP address.</para>
                                        </listitem>
                                        <listitem>
                                            <para>port (<emphasis>string</emphasis>, ’80’): The
                                                port to connect to.</para>
                                        </listitem>
                                        <listitem>
                                            <para>servlet (<emphasis>string</emphasis>,
                                                ’geonetwork’). The servlet name choosen in the
                                                remote site.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>searches [0..1]: A container for search parameters.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>search [0..n]: A container for a single search on
                                                a siteID. You can specify 0 or more searches. If no
                                                search element is provided, an unconstrained search
                                                is performed.</para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>freeText (<emphasis>string</emphasis>, ”)
                                                 : Free text to search. This and the
                                                  following parameters are the same used
                                                  during normal search using the web
                                                  interface.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>title (<emphasis>string</emphasis>, ”):
                                                  Search the title field.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>abstract (<emphasis>string</emphasis>, ”)
                                                 : Search the abstract field.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>keywords (<emphasis>string</emphasis>, ”)
                                                 : Search the keywords fields.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>digital (<emphasis>boolean</emphasis>,
                                                  ’false’): Search for metadata in digital
                                                  form.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>hardcopy (<emphasis>boolean</emphasis>,
                                                  ’false’): Search for metadata in printed
                                                  form.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>source (<emphasis>string</emphasis>, ”):
                                                  One of the sources present on the remote
                                                  node.</para>
                                                </listitem>
                                            </itemizedlist>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>groupsCopyPolicy [0..1]: Container for copy policies of
                                        remote groups. This mechanism is used to retain remote
                                        metadata privileges.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>group: There is one copy policy for each remote
                                                group. This element must have 2 mandatory
                                                attributes: <emphasis>name</emphasis> and
                                                  <emphasis>policy</emphasis>. The name attribute
                                                is the remote group’s name. If the remote group is
                                                renamed, it is not found anymore and the copy policy
                                                is skipped. The policy attribute represents the
                                                policy itself and can be: <emphasis>copy</emphasis>,
                                                  <emphasis>createAndCopy</emphasis>,
                                                  <emphasis>copyToIntranet</emphasis>. copy means
                                                that remote privileges are copied locally if there
                                                is locally a group with the same name as the
                                                  <emphasis>name</emphasis> attribute.
                                                createAndCopy works like <emphasis>copy</emphasis>
                                                but the group is created locally if it does not
                                                exist. copyToIntranet works only for the remote
                                                group named all, which represents the public group.
                                                This policy copies privileges of the remote group
                                                named <emphasis>all</emphasis> to the local intranet
                                                group. This is usefull to restrict metadata
                                            access.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    <para><xref linkend="xml_request_harvesting_add"/> shows an example of an XML
                        request to create a GeoNetwork node.</para>
                    <figure id="xml_request_harvesting_add">
                        <title>Example of an xml.harvesting.add request for a geonetwork node</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<node type="geonetwork"> 
    <site> 
        <name>South Africa</name> 
        <host>south.africa.org</host> 
        <port>8080</port> 
        <servlet>geonetwork</servlet> 
        <account> 
            <use>true</use> 
            <username>admin</username> 
            <password>admin</password> 
        </account> 
    </site> 
    <searches> 
        <search> 
            <freeText /> 
            <title /> 
            <abstract /> 
            <keywords /> 
            <digital>true</digital> 
            <hardcopy>false</hardcopy> 
            <source>0619cc50-708b-11da-8202-000d9335906e</source> 
        </search> 
    </searches> 
    <options> 
        <every>90</every> 
        <oneRunOnly>false</oneRunOnly> 
    </options> 
    <groupsCopyPolicy> 
        <group name="all" policy="copy"/> 
        <group name="mygroup" policy="createAndCopy"/> 
    </groupsCopyPolicy> 
    <categories> 
        <category id="4"/> 
    </categories> 
</node>]]></programlisting>
                    </figure>
                    <para>WebDAV harvesting</para>
                    <para>To create a web DAV node, the following XML information should be
                        provided.</para>
                    <itemizedlist>
                        <listitem>
                            <para>node: The type attribute is mandatory and must be webdav.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>site</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>url (<emphasis>string</emphasis>, ”): The URL to
                                                harvest from. If provided, must be a valid URL
                                                starting with ’HTTP://’.</para>
                                        </listitem>
                                        <listitem>
                                            <para>icon (<emphasis>string</emphasis>, ’default.gif’)
                                               : Icon file used to represent this node in the
                                                search results. The icon must be present into the
                                                images/harvesting folder.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>options</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>recurse (<emphasis>boolean</emphasis>, ’false’):
                                                When true, folders are scanned recursively to find
                                                metadata.</para>
                                        </listitem>
                                        <listitem>
                                            <para>validate (<emphasis>boolean</emphasis>, ’false’):
                                                When true, GeoNetwork will validate every metadata
                                                against its schema. If the metadata is not valid, it
                                                will not be imported.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    <para>This type supports both privileges and categories assignment.</para>
                    <para><xref linkend="xml_request_harvesting_add_entry"/> shows an example of an
                        XML request to create a web DAV entry.</para>
                    <figure id="xml_request_harvesting_add_entry">
                        <title>Example of an xml.harvesting.add request for a WebDAV node</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<node type="webdav"> 
    <site> 
        <name>Asia remote node</name> 
        <url>http://www.mynode.org/metadata</url> 
        <icon>default.gif</icon> 
        <account> 
            <use>true</use> 
            <username>admin</username> 
            <password>admin</password> 
        </account> 
    </site> 
    <options> 
        <every>90</every> 
        <oneRunOnly>false</oneRunOnly> 
        <recurse>false</recurse> 
        <validate>true</validate> 
    </options> 
    <privileges> 
        <group id="0"> 
            <operation name="view" /> 
        </group> 
        <group id="14"> 
            <operation name="features" /> 
        </group> 
    </privileges> 
    <categories> 
        <category id="4"/> 
    </categories> 
</node>]]></programlisting>
                    </figure>
                    <para>CSW harvesting</para>
                    <para>To create a node to harvest from a CSW capable server, the following XML
                        information should be provided:</para>
                    <itemizedlist>
                        <listitem>
                            <para>node: The type attribute is mandatory and must be csw.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>site</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>capabilitiesUrl (<emphasis>string</emphasis>):
                                                URL of the capabilities file that will be used to
                                                retrieve the operations address.</para>
                                        </listitem>
                                        <listitem>
                                            <para>icon (<emphasis>string</emphasis>, ’default.gif’)
                                               : Icon file used to represent this node in the
                                                search results. The icon must be present into the
                                                images/harvesting folder.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>searches [0..1]</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>search [0..n]: Contains search parameters. If
                                                this element is missing, an unconstrained search
                                                will be performed.</para>
                                            <itemizedlist>
                                                <listitem>
                                                  <para>freeText (<emphasis>string</emphasis>, ”)
                                                 : Search the entire metadata.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>title (<emphasis>string</emphasis>, ”):
                                                  Search the dc:title queryable.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>abstract (<emphasis>string</emphasis>, ”):
                                                  Search the dc:abstract queryable.</para>
                                                </listitem>
                                                <listitem>
                                                  <para>subject (<emphasis>string</emphasis>, ”):
                                                  Search the dc:subject queryable.</para>
                                                </listitem>
                                            </itemizedlist>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    <para>This type supports both privileges and categories assignment.</para>
                    <para><xref linkend="xml_request_harvesting_add_csw"/> shows an example of an
                        XML request to create a CSW entry.</para>
                    <figure id="xml_request_harvesting_add_csw">
                        <title>Example of an xml.harvesting.add request for a CSW node</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<node type="csw"> 
    <site> 
        <name>Minos CSW server</name> 
        <capabilitiesUrl>http://www.minos.org/csw?request=GetCapabilities 
            &amp;amp;service=CSW&amp;amp;acceptVersions=2.0.1</capabilitiesUrl> 
        <icon>default.gif</icon> 
        <account> 
            <use>true</use> 
            <username>admin</username> 
            <password>admin</password> 
        </account> 
    </site> 
    <options> 
        <every>90</every> 
        <oneRunOnly>false</oneRunOnly> 
        <recurse>false</recurse> 
        <validate>true</validate> 
    </options> 
    <privileges> 
        <group id="0"> 
            <operation name="view" /> 
        </group> 
        <group id="14"> 
            <operation name="features" /> 
        </group> 
    </privileges> 
    <categories> 
        <category id="4"/> 
    </categories> 
</node>]]></programlisting>
                    </figure>
                </section>
                <section>
                    <title>Response</title>
                    <para>The service’s response is the output of the
                        <literal>xml.harvesting.get</literal> service of the newly created
                    node.</para>
                </section>
                <section>
                    <title>Summary</title>
                    <para>The following table:</para>
                    <table frame="all" id="harvesting_types">
                        <title>Summary of features of the supported harvesting types</title>
                        <tgroup cols="4">
                            <colspec colnum="1" colname="c1"/>
                            <colspec colnum="2" colname="c2"/>
                            <colspec colnum="3" colname="c3"/>
                            <colspec colnum="4" colname="c4"/>
                            <thead>
                                <row>
                                    <entry>
                                        <para>Harvesting type</para>
                                    </entry>
                                    <entry>
                                        <para>Authentication</para>
                                    </entry>
                                    <entry>
                                        <para>Privileges ?</para>
                                    </entry>
                                    <entry>
                                        <para>Categories ?</para>
                                    </entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>GeoNetwork</para>
                                    </entry>
                                    <entry>
                                        <para>native</para>
                                    </entry>
                                    <entry>
                                        <para>through policies</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>Web DAV</para>
                                    </entry>
                                    <entry>
                                        <para>HTTP digest</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>CSW</para>
                                    </entry>
                                    <entry>
                                        <para>HTTP Basic</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </section>
            </section>
            <section>
                <title>xml.harvesting.update</title>
                <para>This service is responsible for changing the node’s parameters. A typical
                    request has a node root element and must include the id attribute:</para>
                <programlisting><?db-font-size 75% ?><![CDATA[<node id="24"> 
    ... 
</node>]]></programlisting>
                <para>The body of the node element depends on the node’s type. The update policy is
                    this:</para>
                <itemizedlist>
                    <listitem>
                        <para>If an element is specified, the associated parameter is updated.
                        </para>
                    </listitem>
                    <listitem>
                        <para>If an element is not specified, the associated parameter will not be
                            changed.</para>
                    </listitem>
                </itemizedlist>
                <para>So, you need to specify only the elements you want to change. However, there
                    are some exceptions:</para>
                <para>privileges If this element is omitted, privileges will not be changed. If
                    specified, new privileges will replace the old ones. categories Like the
                    previous one. searches Some harvesting types support multiple searches on the
                    same remote note. When supported, the updated behaviour should be like the
                    previous ones.</para>
                <para>Note that you cannot change the type of an node once it has been created.</para>
                <section>
                    <title>Request</title>
                    <para>The request is the same as that used to add an entry. Only the id
                        attribute is mandatory.</para>
                </section>
                <section>
                    <title>Response</title>
                    <para>The response is the same as the xml.harvesting.get called on the updated
                        entry.</para>
                </section>
            </section>
            <section>
                <title>xml.harvesting.remove/start/stop/run</title>
                <para>These services are put together because they share a common request interface.
                    Their purpose is obviously to remove, start, stop or run a harvesting node. In
                    detail:</para>
                <para>start When created, a node is in the inactive state. This operation makes it
                    active, that is the countdown is started and the harvesting will be performed at
                    the timeout. stop Makes a node inactive. Inactive nodes are never harvested. run
                    Just start the harvester now. Used to test the harvesting.</para>
                <section>
                    <title>Request</title>
                    <para>A set of ids to operate on. Example:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<request>
    <id>123</id>
    <id>456</id>
    <id>789</id>
</request>]]></programlisting>
                    <para>If the request is empty, nothing is done.</para>
                </section>
                <section>
                    <title>Response</title>
                    <para>The same as the request but every id has a status attribute indicating the
                        success or failure of the operation. For example, the response to the
                        previous request could be:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<request>
    <id status="ok">123</id>
    <id status="not-found">456</id>
    <id status="inactive">789</id>
</request>]]></programlisting>
                    <para><xref linkend="table_service_status"/> summarizes, for each service, the
                        possible status values.</para>
                    <table frame="all" id="table_service_status">
                        <title>Summary of status values</title>
                        <tgroup cols="4">
                            <colspec colnum="1" colname="c1"/>
                            <colspec colnum="2" colname="c2"/>
                            <colspec colnum="3" colname="c3"/>
                            <colspec colnum="4" colname="c4"/>
                            <thead>
                                <row>
                                    <entry>
                                        <para>Status value</para>
                                    </entry>
                                    <entry>
                                        <para>remove</para>
                                    </entry>
                                    <entry>
                                        <para>start</para>
                                    </entry>
                                    <entry>
                                        <para>stop</para>
                                    </entry>
                                    <entry>
                                        <para>run</para>
                                    </entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>ok</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>not-found</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>inactive</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>already-inactive</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>already-active</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>already-running</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                    <entry>
                                        <para>+</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </section>
            </section>
        </section>
        <section>
            <title>System configuration</title>
            <section>
                <title>Introduction</title>
                <para>The GeoNetwork’s configuration is made up of a set of parameters that can be
                    changed to accomodate any installation need. These parameters are subdivided
                    into 2 groups:</para>
                <itemizedlist>
                    <listitem>
                        <para>parameters that can be easily changed through a web interface.</para>
                    </listitem>
                    <listitem>
                        <para>parameters not accessible from a web interface and that must be
                            changed when the system is not running.</para>
                    </listitem>
                </itemizedlist>
                <para>The first group of parameters can be queried or changed through 2 services:
                    xml.config.get and xml.config.update. The second group of parameters can be
                    changed using the GAST tool.</para>
            </section>
            <section>
                <title>xml.config.get</title>
                <para>This service returns the system configuration’s parameters.</para>
                <section>
                    <title>Request</title>
                    <para>No parameters are needed.</para>
                </section>
                <section>
                    <title>Response</title>
                    <para>The response is an XML tree similar to the system hierarchy into the
                        settings structure. See ?? for more information. The response has the
                        following elements:</para>
                    <itemizedlist>
                        <listitem>
                            <para>site: A container for site information.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>name: Site’s name.</para>
                                </listitem>
                                <listitem>
                                    <para>organization: Site’s organization name.</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>server: A container for server information.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>host: Name of the host from which the site is reached.
                                    </para>
                                </listitem>
                                <listitem>
                                    <para>port: Port number of the previous host.</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>intranet: Information about the intranet of the organization.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>network: IP address that specifies the network.</para>
                                </listitem>
                                <listitem>
                                    <para>netmask: netmask of the network.</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>z3950: Configuration about Z39.50 protocol.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>enable: true means that the server component is running.
                                    </para>
                                </listitem>
                                <listitem>
                                    <para>port: Port number to use to listen for incoming Z39.50
                                        requests.</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>proxy: Proxy configuration</para>
                            <itemizedlist>
                                <listitem>
                                    <para>use: true means that the proxy is used when connecting to
                                        external nodes.</para>
                                </listitem>
                                <listitem>
                                    <para>host: Proxy’s server host.</para>
                                </listitem>
                                <listitem>
                                    <para>port: Proxy’s server port.</para>
                                </listitem>
                                <listitem>
                                    <para>username: Proxy’s credentials.</para>
                                </listitem>
                                <listitem>
                                    <para>password: Proxy’s credentials.</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>feedback: A container for feeback information</para>
                            <itemizedlist>
                                <listitem>
                                    <para>email: Administrator’s email address</para>
                                </listitem>
                                <listitem>
                                    <para>mailServer: Email server to use to send feedback</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>host: Email’s host address</para>
                                        </listitem>
                                        <listitem>
                                            <para>port: Email’s port to use in host address</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>removedMetadata: A container for removed metadata information</para>
                            <itemizedlist>
                                <listitem>
                                    <para>dir: Folder used to store removed metadata in MEF
                                    format</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>ldap: A container for LDAP parameters</para>
                            <itemizedlist>
                                <listitem>
                                    <para>use:</para>
                                </listitem>
                                <listitem>
                                    <para>host:</para>
                                </listitem>
                                <listitem>
                                    <para>port:</para>
                                </listitem>
                                <listitem>
                                    <para>defaultProfile:</para>
                                </listitem>
                                <listitem>
                                    <para>login:</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>userDN:</para>
                                        </listitem>
                                        <listitem>
                                            <para>password:</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>distinguishedNames:</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>base:</para>
                                        </listitem>
                                        <listitem>
                                            <para>users:</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                                <listitem>
                                    <para>userAttribs:</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>name:</para>
                                        </listitem>
                                        <listitem>
                                            <para>password:</para>
                                        </listitem>
                                        <listitem>
                                            <para>profile:</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    <para><xref linkend="xml_response_config_get"/> shows an example of
                            <literal>xml.config.get</literal> response.</para>
                    <figure id="xml_response_config_get">
                        <title>Example of xml.config.get response</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<config> 
    <site> 
        <name>dummy</name> 
        <organization>dummy</organization> 
    </site> 
    <server> 
        <host>localhost</host> 
        <port>8080</port> 
    </server> 
    <intranet> 
        <network>127.0.0.1</network> 
        <netmask>255.255.255.0</netmask> 
    </intranet> 
    <z3950> 
        <enable>true</enable> 
        <port>2100</port> 
    </z3950> 
    <proxy> 
        <use>false</use> 
        <host/> 
        <port/> 
        <username>proxyuser</username> 
        <password>proxypass</password> 
    </proxy> 
    <feedback> 
        <email/> 
        <mailServer> 
            <host/> 
            <port>25</port> 
        </mailServer> 
    </feedback> 
    <removedMetadata> 
        <dir>WEB-INF/removed</dir> 
    </removedMetadata> 
    <ldap> 
        <use>false</use> 
        <host /> 
        <port /> 
        <defaultProfile>RegisteredUser</defaultProfile> 
        <login> 
            <userDN>cn=Manager</userDN> 
            <password /> 
        </login> 
        <distinguishedNames> 
            <base>dc=fao,dc=org</base> 
            <users>ou=people</users> 
        </distinguishedNames> 
        <userAttribs> 
            <name>cn</name> 
            <password>userPassword</password> 
            <profile>profile</profile> 
        </userAttribs> 
    </ldap> 
</config>]]></programlisting>
                    </figure>
                </section>
            </section>
            <section>
                <title>xml.config.update</title>
                <para>This service is used to update the system’s information and so it is
                    restricted to administrators.</para>
                <section>
                    <title>Request</title>
                    <para>The request format must have the same structure returned by the
                            <literal>xml.config.get</literal> service and can contain only elements
                        that the caller wants to be updated. If an element is not included, it will
                        not be updated. However, when included some elements require mandatory
                        information (i.e. the value cannot be empty). Please, refer to <xref
                            linkend="table_config_parameters"/>.</para>
                    <table frame="all" id="table_config_parameters">
                        <title>Mandatory and optional parameters for the xml.config.update service</title>
                        <tgroup cols="3">
                            <colspec colnum="1" colname="c1"/>
                            <colspec colnum="2" colname="c2"/>
                            <colspec colnum="3" colname="c3"/>
                            <thead>
                                <row>
                                    <entry>
                                        <para>Parameter</para>
                                    </entry>
                                    <entry>
                                        <para>Type</para>
                                    </entry>
                                    <entry>
                                        <para>Mandatory</para>
                                    </entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>site/name</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>site/organization</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>server/host</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>server/port</para>
                                    </entry>
                                    <entry>
                                        <para>integer</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>intranet/network</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>intranet/netmask</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>z3950/enable</para>
                                    </entry>
                                    <entry>
                                        <para>bool</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>z3950/port</para>
                                    </entry>
                                    <entry>
                                        <para>integer</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>proxy/use</para>
                                    </entry>
                                    <entry>
                                        <para>bool</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>proxy/host</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>proxy/port</para>
                                    </entry>
                                    <entry>
                                        <para>integer</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>proxy/username</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>proxy/password</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>feedback/email</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>feedback/mailServer/host</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>feedback/mailServer/port</para>
                                    </entry>
                                    <entry>
                                        <para>integer</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>removedMetadata/dir</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/use</para>
                                    </entry>
                                    <entry>
                                        <para>bool</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/host</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/port</para>
                                    </entry>
                                    <entry>
                                        <para>integer</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/defaultProfile</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/login/userDN</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/login/password</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/distinguishedNames/base</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/distinguishedNames/users</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/userAttribs/name</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/userAttribs/password</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>yes</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>ldap/userAttribs/profile</para>
                                    </entry>
                                    <entry>
                                        <para>string</para>
                                    </entry>
                                    <entry>
                                        <para>-</para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </section>
                <section>
                    <title>Response</title>
                    <para>On success, the service returns a response element with the ok text.
                        Example:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<response>ok</response>]]></programlisting>
                    <para>Otherwise a proper error element is returned.</para>
                </section>
            </section>
        </section>
        <section>
            <title>MEF services</title>
            <section>
                <title>Introduction</title>
                <para>This chapter describes the services related to the Metadata Exchange Format.
                    These services allow to import/export metadata using the MEF format.</para>
            </section>
            <section>
                <title>mef.export</title>
                <para>As the name suggests, this service exports a GeoNetwork’s metadata using the
                    MEF file format.</para>
                <para>This service is public but metadata access rules apply. For a partial export,
                    the view privilege is enough but for a full export the download privilege is
                    also required. Without a login step, only partial exports on public metadata are
                    allowed.</para>
                <para>This service uses the system’s temporary directory to build the MEF file. With
                    full exports of big data maybe it is necessary to change this directory. In this
                    case, use the Java’s -D command line option to set the new directory before
                    running GeoNetwork (if you use Jetty, simply change the script into the bin
                    directory).</para>
                <section>
                    <title>Request</title>
                    <para>This service accepts requests in GET/POST and XML form. The input
                        parameters are:</para>
                    <para>uuid the universal unique identifier of the metadata format which format
                        to use. Can be one of: simple, partial, full. skipUuid If provided, tells
                        the exporter to not export the metadata’s uuid. Without the uuid (which is a
                        unique key inside the database) the metadata can be imported over and over
                        again. Can be one of: true, false. The default value is false.</para>
                </section>
                <section>
                    <title>Response</title>
                    <para>The service’s response is a MEF file with these characteristics:</para>
                    <itemizedlist>
                        <listitem>
                            <para>the name of the file is the metadata’s uuid</para>
                        </listitem>
                        <listitem>
                            <para>the extension of the file is mef</para>
                        </listitem>
                    </itemizedlist>
                </section>
            </section>
            <section>
                <title>mef.import</title>
                <para>This service is reserved to administrators and is used to import a metadata
                    provided in the MEF format.</para>
                <section>
                    <title>Request</title>
                    <para>The service accepts a <literal>multipart/form-data</literal> POST request
                        with a single mefFile parameter that must contain the MEF
                    information.</para>
                </section>
                <section>
                    <title>Response</title>
                    <para>If all goes well, the service returns an ok element containing the local
                        id of the created metadata. Example:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<ok>123</ok>]]></programlisting>
                </section>
            </section>
            <section>
                <title>Metadata ownership</title>
                <para>Version 1.0 of the MEF format does not take into account the metadata owner
                    (the creator) and the group owner. This implies that this information is not
                    contained into the MEF file. During import, the user that is performing this
                    operation will become the metadata owner and the group owner will be set to
                    null.</para>
            </section>
        </section>
        <section>
            <title>Relations</title>
            <section>
                <title>Introduction</title>
                <para>This chapter describes general services used to get and set relations between
                    metadata records inside GeoNetwork. The association is performed by a Relations
                    table which stores a metadata id and a metadata relatedId fields (see <xref
                        linkend="table_relations"/>).</para>
                <table frame="all" id="table_relations">
                    <title>Structure of table Relations</title>
                    <tgroup cols="3">
                        <colspec colnum="1" colname="c1" colwidth="1*"/>
                        <colspec colnum="2" colname="c2" colwidth="3*"/>
                        <colspec colnum="3" colname="c3" colwidth="3*"/>
                        <thead>
                            <row>
                                <entry>
                                    <para>Field</para>
                                </entry>
                                <entry>
                                    <para>Datatype</para>
                                </entry>
                                <entry>
                                    <para>Description</para>
                                </entry>
                            </row>
                        </thead>
                        <tbody>
                            <row>
                                <entry>
                                    <para>id</para>
                                </entry>
                                <entry>
                                    <para>foreign key to Metadata(id)</para>
                                </entry>
                                <entry>
                                    <para>Source metadata whose relation is being described. </para>
                                </entry>
                            </row>
                            <row>
                                <entry>
                                    <para>relatedId</para>
                                </entry>
                                <entry>
                                    <para>foreign key to Metadata(id)</para>
                                </entry>
                                <entry>
                                    <para>Metadata related to the source one</para>
                                </entry>
                            </row>
                        </tbody>
                    </tgroup>
                </table>
            </section>
            <section>
                <title>xml.relation.get</title>
                <para>This service retrieves all relations between metadata.</para>
                <section>
                    <title>Request</title>
                    <para>The request accepts an id and a relation parameters, whose meaning is
                        this:</para>
                    <itemizedlist>
                        <listitem>
                            <para>id (<emphasis>integer</emphasis>): This is the local GeoNetwork
                                identifier of the metadata whose relations are requested.</para>
                        </listitem>
                        <listitem>
                            <para>relation (<emphasis>string</emphasis>, ’normal’): This optional
                                parameter identifies the kind of relation that the client wants to
                                be returned. It can be one of these values:</para>
                            <itemizedlist>
                                <listitem>
                                    <para>normal: The service performs a query into the id field
                                        and returns all relatedId records.</para>
                                </listitem>
                                <listitem>
                                    <para>reverse: The service performs a query into the relatedId
                                        field and returns all id records.</para>
                                </listitem>
                                <listitem>
                                    <para>full: Includes both normal and reverse queries
                                        (duplicated ids are removed).</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    <para>Here is an example of POST/XML request:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<request>
    <id>10</id>
    <relation>full</relation>
</request>]]></programlisting>
                </section>
                <section>
                    <title>Response</title>
                    <para>The response has a response root element with several metadata children
                        depending on the relations found. Example:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<response>
    <metadata>...</metadata>
    <metadata>...</metadata>
    ... 
</response>]]></programlisting>
                    <para>Each metadata element has the following structure:</para>
                    <itemizedlist>
                        <listitem>
                            <para>title: Metadata title</para>
                        </listitem>
                        <listitem>
                            <para>abstract: A brief explanation of the metadata</para>
                        </listitem>
                        <listitem>
                            <para>keyword: Keywords found inside the metadata</para>
                        </listitem>
                        <listitem>
                            <para>image: Information about thumbnails</para>
                        </listitem>
                        <listitem>
                            <para>link: A link to the source site</para>
                        </listitem>
                        <listitem>
                            <para>geoBox: coordinates of the bounding box</para>
                        </listitem>
                        <listitem>
                            <para>geonet:info: A container for GeoNetwork related
                            information</para>
                        </listitem>
                    </itemizedlist>
                    <figure id="xml_metadata_example">
                        <title>Example of a metadata record</title>
                        <programlisting><?db-font-size 75% ?><![CDATA[<metadata> 
    <title>Globally threatened species of the world</title> 
    <abstract> Contains information on animals.</abstract> 
    <keyword>biodiversity</keyword> 
    <keyword>endangered animal species</keyword> 
    <keyword>endangered plant species</keyword> 
    <link type="url">http://www.mysite.org</link> 
    <geoBox> 
        <westBL>-180.0</westBL> 
        <eastBL>180.0</eastBL> 
        <southBL>-90.0</southBL> 
        <northBL>90.0</northBL> 
    </geoBox> 
    <geonet:info> 
        <id>11</id> 
        <schema>fgdc-std</schema> 
        <createDate>2005-03-31T19:13:31</createDate> 
        <changeDate>2007-03-12T14:52:46</changeDate> 
        <isTemplate>n</isTemplate> 
        <title/> 
        <source>38b75c1b-634b-443e-9c36-a12e89b4c866</source> 
        <uuid>84b4190b-de43-4bd7-b25f-6ed47eb239ac</uuid> 
        <isHarvested>n</isHarvested> 
        <view>true</view> 
        <admin>false</admin> 
        <edit>false</edit> 
        <notify>false</notify> 
        <download>true</download> 
        <dynamic>false</dynamic> 
        <featured>false</featured> 
    </geonet:info> 
</metadata>]]></programlisting>
                    </figure>
                </section>
            </section>
        </section>
        <section>
            <title>Schema information</title>
            <section>
                <title>Introduction</title>
                <para>GeoNetwork is able to handle several metadata schema formats. Up to now, the
                    supported schemas are:</para>
                <itemizedlist>
                    <listitem>
                        <para>ISO-19115 (iso19115): GeoNetwork implements an old version of the
                            draft, which uses short names for elements. This is not so standard so
                            this schema is obsolete and will be removed in future releases.</para>
                    </listitem>
                    <listitem>
                        <para>ISO-19139 (iso19139): This is the XML encoding of the ISO 19115:2007
                            metadata specification.</para>
                    </listitem>
                    <listitem>
                        <para>Dublin core (dublin-core): This is a simple metadata schema based on
                            a set of elements capable of describing any metadata.</para>
                    </listitem>
                    <listitem>
                        <para>FGDC (fgdc-std): It stands for Federal Geographic Data Committee and
                            it is a metadata schema used in North America.</para>
                    </listitem>
                </itemizedlist>
                <para>In parenthesis is indicated the name used by GeoNetwork to refer to that
                    schema. These schemas are handled through their XML schema files (XSD), which
                    GeoNetwork loads and interprets to allow the editor to add and remove elements.
                    Beside its internal use, GeoNetwork provides some useful XML services to find
                    out some element properties, like label, description and so on.</para>
            </section>
            <section>
                <title>xml.schema.info</title>
                <para>This service returns information about a set of schema elements or codelists.
                    The returned information consists of a localized label, a description,
                    conditions that the element must satisfy etc...</para>
                <section>
                    <title>Request</title>
                    <para>Due to its nature, this service accepts only the POST binding with
                            <literal>application/XML</literal> content type. The request can contain
                        several element and codelist elements. Each element indicate the will to
                        retrieve information for that element. Here follows the element
                        descriptions:</para>
                    <itemizedlist>
                        <listitem>
                            <para>element: It must contain a schema and a name attribute. The first
                                one must be one of the supported schemas (see the section above).
                                The second must be the qualified name of the element which
                                information must be retrieved. The namespace must be declared into
                                this element or into the root element of the request.</para>
                        </listitem>
                        <listitem>
                            <para>codelist: Works like the previous one but returns information
                                about codelists.</para>
                        </listitem>
                    </itemizedlist>
                    <programlisting><?db-font-size 75% ?><![CDATA[<request xmlns:gmd="http://www.isotc211.org/2005/gmd"> 
    <element schema="iso19139" name="gmd:constraintLanguage" /> 
    <codelist schema="iso19115" name="DateTypCd" /> 
</request>]]></programlisting>
                    <para>Note</para>
                    <para>The returned text is localized depending on the language specified during
                        the service call. A call to <uri>/geonetwork/srv/en/xml.schema.info</uri>
                        will return text in the English language.</para>
                </section>
                <section>
                    <title>Response</title>
                    <para>The response’s root element will be populated with information of the
                        elements/codelists specified into the request. The structure is the
                        following:</para>
                    <itemizedlist>
                        <listitem>
                            <para>element: A container for information about an element. It has a
                                name attribute which contains the qualified name of the element.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>label: The human readable name of the element, localized
                                        into the request’s language.</para>
                                </listitem>
                                <listitem>
                                    <para>description: A generic description of the element.
                                    </para>
                                </listitem>
                                <listitem>
                                    <para>condition [0..1]: This element is optional and indicates
                                        if the element must satisfy a condition, like the element is
                                        always mandatory or is mandatory if another one is
                                    missing.</para>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                        <listitem>
                            <para>codelist: A container for information about a codelist. It has a
                                name attribute which contains the qualified name of the codelist.</para>
                            <itemizedlist>
                                <listitem>
                                    <para>entry [1..n]: A container for a codelist entry. There can
                                        be many entries.</para>
                                    <itemizedlist>
                                        <listitem>
                                            <para>code: The entry’s code. This is the value that
                                                will be present inside the metadata.</para>
                                        </listitem>
                                        <listitem>
                                            <para>label: This is a human readable name, used to
                                                show the entry into the user interface. It is
                                                localized.</para>
                                        </listitem>
                                        <listitem>
                                            <para>description: A generic localized description of
                                                the codelist.</para>
                                        </listitem>
                                    </itemizedlist>
                                </listitem>
                            </itemizedlist>
                        </listitem>
                    </itemizedlist>
                    <programlisting><?db-font-size 75% ?><![CDATA[<response> 
    <element name="gmd:constraintLanguage"> 
        <label>Constraint language</label> 
        <description>language used in Application Schema</description> 
        <condition>mandatory</condition> 
    </element> 
    <codelist name="DateTypCd"> 
        <entry> 
            <code>creation</code> 
            <label>Creation</label> 
            <description>date when the resource was brought into existence</description> 
        </entry> 
        <entry> 
            <code>publication</code> 
            <label>Publication</label> 
            <description>date when the resource was issued</description> 
        </entry> 
        <entry> 
            <code>revision</code> 
            <label>Revision</label> 
            <description>date identifies when the resource was examined 
                or re-examined and improved or amended</description> 
        </entry> 
    </codelist> 
</response>]]></programlisting>
                </section>
                <section>
                    <title>Error management</title>
                    <para>Beside the normal exceptions management discussed in section ??, the
                        service can encounter some errors trying to retrieve an element/codelist
                        information. In this case, the object is copied verbatim to the response
                        with the addition of an error attribute that describes the encountered
                        error. The returned errors are described in <xref
                            linkend="table_schema_errors"/>. Here follows an example of such
                        response:</para>
                    <programlisting><?db-font-size 75% ?><![CDATA[<response>
    <element schemma="iso19139" name="blablabla" error="not-found"/>
</response>]]></programlisting>
                    <table frame="all" id="table_schema_errors">
                        <title>Possible errors returned by xml.schema.info service</title>
                        <tgroup cols="2">
                            <colspec colnum="1" colname="c1" colwidth="1*"/>
                            <colspec colnum="2" colname="c2" colwidth="2*"/>
                            <thead>
                                <row>
                                    <entry>
                                        <para>Error code</para>
                                    </entry>
                                    <entry>
                                        <para>Description</para>
                                    </entry>
                                </row>
                            </thead>
                            <tbody>
                                <row>
                                    <entry>
                                        <para>unknown-schema</para>
                                    </entry>
                                    <entry>
                                        <para>The specified schema is not supported</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>unknown-namespace</para>
                                    </entry>
                                    <entry>
                                        <para>The namespace of the specified prefix was not
                                        found</para>
                                    </entry>
                                </row>
                                <row>
                                    <entry>
                                        <para>not-found</para>
                                    </entry>
                                    <entry>
                                        <para>The requested element / codelist was not found </para>
                                    </entry>
                                </row>
                            </tbody>
                        </tgroup>
                    </table>
                </section>
            </section>
        </section>
    </chapter>
</book>
