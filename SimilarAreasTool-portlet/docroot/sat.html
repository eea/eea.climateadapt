<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Prototype Similar Areas Tool</title>
		<script type='text/javascript' src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=6.2&amp;mkt=en-us"></script>
		<script type='text/javascript' src="js/proj4js/lib/proj4js-combined.js"></script>
		<script type='text/javascript' src='js/OpenLayers.js'></script>
		<script type="text/javascript" src="js/chm/CHM.js"></script>
		<script type="text/javascript" src="js/chm/CHMMap.js"></script>
		<script type="text/javascript" src="js/chm/SATCHMMap.js"></script>
		<script type="text/javascript" src="js/chm/SATVector.js"></script>
		<script type="text/javascript" src="js/chm/Resource.js"></script>
		<script type="text/javascript" src="js/chm/ResourceSet.js"></script>
		<script type="text/javascript" src="js/chm/Point.js"></script>
		<script type="text/javascript" src="js/chm/Locator.js"></script>
		<script type="text/javascript" src="js/chm/Location.js"></script>
		<script type="text/javascript" src="js/chm/LocationControl.js"></script>
		<script type="text/javascript">
			var satchmmap;
			
			var locator;
			
			function init() {
				
				satchmmap = new CHM.SATCHMMap('map_element', {});
				
				locator = new CHM.Locator('locations_element', {});
				
				locator.setOnLocationChanged(handleLocationChanged);
				
				riskChange();
				
				sectorChange();
			}
			
			function getSelectedValue(select) {
				return select.options[select.selectedIndex].value;
			}
			
			function riskChange() {
				var risk = getSelectedValue(document.getElementById('riskSelect'));
				
				satchmmap.setRisk(risk);
			}
			
			function sectorChange() {
				var sector = getSelectedValue(document.getElementById('sectorSelect'));
				
				satchmmap.setSector(sector);
			}
			
			function locate(aLocation) {
				locator.locate(aLocation);
			}
			
			function handleLocationChanged() {
				satchmmap.setLocation(locator.getLocation());
			}
		</script>
	</head>
	<body onload="init();">

		<form>
			<select id="riskSelect" onchange="riskChange()">
				<option value="EXTREMETEMP">Extreme Temperatures</option>
				<option value="WATERSCARCE">Water Scarcity</option>
				<option value="FLOODING">Flooding</option>
				<option value="SEALEVELRISE">Sea Level Rise</option>
				<option value="DROUGHT">Droughts</option>
				<option value="STORM">Storms</option>
				<option value="ICEANDSNOW">Ice and Snow</option>
			</select>
			<select id="sectorSelect" onchange="sectorChange()">
				<option value="AGRICULTURE">Agriculture and Forest</option>
				<option value="BIODIVERSITY">Biodiversity</option>
				<option value="COASTAL">Coastal areas</option>
				<option value="DISASTERRISKREDUCTION">Disaster Risk Reduction</option>
				<option value="FINANCIAL">Financial</option>
				<option value="HEALTH">Health</option>
				<option value="INFRASTRUCTURE">Infrastructure</option>
				<option value="MARINE">Marine and Fisheries</option>
				<option value="WATERMANAGEMENT">Water management</option>
			</select>
		</form>

		<div id="locator">
			<input type="text" name="location" id="location" />
			<a onclick="locate(document.getElementById('location').value)">Locate</a>
		</div>

		<div id='map_element' style='width: 500px; height: 500px;'></div>

		<div id='locations_element'></div>

		<script>
			var proxyUrl = '';
			
			var geoserverUrl = 'http://localhost/geoserver/';
			
			var wfs = 'wfs';
			
			var wms = 'wms';
	
			var locatorUrl = 'http://localhost/ve/REST/v1/Locations/';
			
			var locatorKey = 'Ao9qujBzDtg-nFiusTjt5VQ9x2NJB2wAD7YCRjaPz7hQQjxdFcl24tyhOwCDCIrw';
			
			var satchmmap = new CHM.SATCHMMap('map_element', {});
						
			var locator = new CHM.Locator('locations_element', {});
			
		    $(document).ready(function() {
		    	console.log("Document ready!");
		    	
		    	satchmmap = new CHM.SATCHMMap('map_element', {});
				
		    	locator = new CHM.Locator('locations_element', {});
		
		    	locator.setOnLocationChanged(handleLocationChanged);
		    	
		    	riskChange();
		    				
		    	sectorChange();
		    });
		
			function handleLocationChanged() {
				satchmmap.setLocation(locator.getLocation());
			}
		    		
		    function getSelectedValue(select) {
		    	return select.options[select.selectedIndex].value;
		    }
		    			
		    function riskChange() {
		    	var risk = getSelectedValue(document.getElementById('riskSelect'));
		    				
		    	satchmmap.setRisk(risk);
		    }
		    			
		    function sectorChange() {
		    	var sector = getSelectedValue(document.getElementById('sectorSelect'));
		    			
		    	satchmmap.setSector(sector);
		    }
		    	
		    function locate(aLocation) {
		    	locator.locate(aLocation);
		    }
		</script>
	</body>
</html>
